---
# tasks file for jenkins
- name: "Add Jenkins Apt key"
  apt_key:
        url=https://jenkins-ci.org/debian/jenkins-ci.org.key

- name: "Add Jenkins repository"
  apt_repository:
        repo='deb http://pkg.jenkins-ci.org/debian-stable binary/'

- name: "Install Jenkins"
  apt:  name=jenkins

- name: "Disable Jenkins wizard"
  lineinfile:
    dest=/etc/default/jenkins
    insertafter='^JAVA_ARGS='
    regexp='^JAVA_ARGS=\"\$JAVA_ARGS '
    line='JAVA_ARGS="$JAVA_ARGS -Djenkins.install.runSetupWizard=false"'
  register: jenkins_config

- name: "Immediately restart Jenkins service"
  service:
        name=jenkins
        state=restarted
  when: jenkins_config.changed

- name: "Configure authentication"
  lineinfile:
    dest=/var/lib/jenkins/config.xml
    regexp='<useSecurity>.*</useSecurity>'
    line='  <useSecurity>false</useSecurity>'
  notify: "Jenkins restart"
